name: Update Domain Rule Count Badge Data

on:
  push:
    branches:
      - main # 当 main 分支有新的 push 时触发
    paths:
      - 'config.json' # <-- 指定你的 JSON 文件路径，只在该文件变化时触发 (优化)
  schedule:
    - cron: '0 */2 * * *' # 每两小时更新一次 UTC 时间

  workflow_dispatch: # 允许手动触发 (可选)

jobs:
  update_data:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: Run script to count rules and generate badge data
      # 运行你的 Python 脚本
      # config.json 就在仓库根目录，所以直接传递文件名作为参数
      # 脚本会在当前目录下创建 badge_data 文件夹并将输出文件放在里面
      run: python count_rules.py config.json

    - name: Deploy badge data to gh-pages
      # 使用 peaceiris/actions-gh-pages 将生成的数据文件发布到 gh-pages 分支
      uses: peaceiris/actions-gh-pages@v4
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: badge_data # <--- 修改这里：指定只发布 badge_data 目录的内容
        publish_branch: gh-pages
        # cname: your-domain.com # 如果你的 GitHub Pages 使用了自定义域名，取消注释并替换
        # destination_dir: badge # 如果你希望在 gh-pages 分支下再创建一个子目录，可以将这里设置为 '/' 或其他名称
        title: 检查了一次当前仓库的规则数量
